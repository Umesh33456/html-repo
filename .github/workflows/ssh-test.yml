name: Check and Install Apache

on:
  workflow_dispatch:

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Setup SSH
        run: |
          mkdir -p ~/.ssh
          echo "${{ secrets.SSH_PRIVATE_KEY }}" > ~/.ssh/id_rsa
          chmod 600 ~/.ssh/id_rsa
          ssh-keyscan -H 54.227.114.152 >> ~/.ssh/known_hosts

      - name: Check and Install Apache
        run: |
          ssh -o StrictHostKeyChecking=no devuser@54.227.114.152 "
            echo 'Checking Apache package...'

            if dpkg -l | grep -q apache2; then
              echo 'âœ… Apache already installed'
            else
              echo 'ðŸš€ Installing Apache...'
              sudo apt update -y
              sudo apt install apache2 -y
              sudo systemctl enable apache2
              sudo systemctl start apache2
              echo 'âœ… Apache installed successfully'
            fi

            echo 'Current Apache Status:'
            sudo systemctl status apache2 --no-pager
          "
